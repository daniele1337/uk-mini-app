#!/bin/bash

# Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð´Ð»Ñ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ¸ ÐºÐ¾Ð´Ð° Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€
echo "ðŸ“¦ ÐŸÐ¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²ÐºÐ° ÐºÐ¾Ð´Ð° Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€..."

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¹
mkdir -p server_upload/frontend
mkdir -p server_upload/backend

# ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ frontend Ñ„Ð°Ð¹Ð»Ð¾Ð²
echo "ðŸ“ ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ frontend Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
cp -r src server_upload/frontend/
cp -r public server_upload/frontend/
cp package.json server_upload/frontend/
cp vite.config.js server_upload/frontend/
cp tailwind.config.js server_upload/frontend/
cp postcss.config.js server_upload/frontend/
cp index.html server_upload/frontend/

# ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ backend Ñ„Ð°Ð¹Ð»Ð¾Ð²
echo "ðŸ“ ÐšÐ¾Ð¿Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ðµ backend Ñ„Ð°Ð¹Ð»Ð¾Ð²..."
cp app.py server_upload/backend/
cp requirements.txt server_upload/backend/

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð´Ð¸Ñ€ÐµÐºÑ‚Ð¾Ñ€Ð¸Ð¸ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·Ð¾Ðº
mkdir -p server_upload/backend/uploads

# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ README Ð´Ð»Ñ ÑÐµÑ€Ð²ÐµÑ€Ð°
cat > server_upload/README.md << 'EOF'
# Telegram Mini App - Ð¡ÐµÑ€Ð²ÐµÑ€Ð½Ð°Ñ Ð²ÐµÑ€ÑÐ¸Ñ

## Ð¡Ñ‚Ñ€ÑƒÐºÑ‚ÑƒÑ€Ð° Ð¿Ñ€Ð¾ÐµÐºÑ‚Ð°:
```
/var/www/uk-mini-app/
â”œâ”€â”€ frontend/          # React Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ
â”œâ”€â”€ backend/           # Flask API
â”œâ”€â”€ logs/             # Ð›Ð¾Ð³Ð¸ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ñ
â”œâ”€â”€ deploy.sh         # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ñ€Ð°Ð·Ð²ÐµÑ€Ñ‚Ñ‹Ð²Ð°Ð½Ð¸Ñ
â”œâ”€â”€ start.sh          # Ð¡ÐºÑ€Ð¸Ð¿Ñ‚ Ð·Ð°Ð¿ÑƒÑÐºÐ°
â””â”€â”€ ecosystem.config.js # ÐšÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ñ PM2
```

## Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ°:

1. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ frontend/ Ð² /var/www/uk-mini-app/frontend/
2. Ð¡ÐºÐ¾Ð¿Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ð¼Ð¾Ðµ backend/ Ð² /var/www/uk-mini-app/backend/
3. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ: cd /var/www/uk-mini-app && ./deploy.sh
4. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ: ./start.sh

## URL Ð´Ð»Ñ Telegram Mini App:
- Frontend: https://2a03:6f00:a::1:17a6
- Backend API: https://2a03:6f00:a::1:17a6/api/

## Ð£Ð¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ:
- ÐŸÑ€Ð¾ÑÐ¼Ð¾Ñ‚Ñ€ Ð»Ð¾Ð³Ð¾Ð²: pm2 logs
- ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº: pm2 restart all
- Ð¡Ñ‚Ð°Ñ‚ÑƒÑ: pm2 status
EOF

echo "âœ… ÐšÐ¾Ð´ Ð¿Ð¾Ð´Ð³Ð¾Ñ‚Ð¾Ð²Ð»ÐµÐ½ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸!"
echo "ðŸ“ Ð¤Ð°Ð¹Ð»Ñ‹ Ð½Ð°Ñ…Ð¾Ð´ÑÑ‚ÑÑ Ð² Ð¿Ð°Ð¿ÐºÐµ: server_upload/"
echo ""
echo "ðŸ“‹ Ð˜Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸ Ð´Ð»Ñ Ð·Ð°Ð³Ñ€ÑƒÐ·ÐºÐ¸ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€:"
echo "1. ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÐµÑÑŒ Ðº ÑÐµÑ€Ð²ÐµÑ€Ñƒ: ssh root@2a03:6f00:a::1:17a6"
echo "2. Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ ÑÐµÑ€Ð²ÐµÑ€Ð°"
echo "3. Ð—Ð°Ð³Ñ€ÑƒÐ·Ð¸Ñ‚Ðµ Ñ„Ð°Ð¹Ð»Ñ‹ Ð¸Ð· server_upload/ Ð½Ð° ÑÐµÑ€Ð²ÐµÑ€"
echo "4. Ð—Ð°Ð¿ÑƒÑÑ‚Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¸Ð»Ð¾Ð¶ÐµÐ½Ð¸Ðµ" 